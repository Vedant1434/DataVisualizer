<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>CSV Data Viewer</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 1rem; background-color: #f9f9f9; }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 0.5rem; }
        .error { color: #D8000C; background-color: #FFD2D2; border: 1px solid #D8000C; padding: 1rem; border-radius: 4px; margin: 1rem 0; }
        .info { background-color: #e6f7ff; border: 1px solid #b3e0ff; padding: 1rem; border-radius: 4px; margin: 1rem 0; }
        .info code { background: #d1ecff; padding: 2px 4px; border-radius: 3px; }
        .filter-form { display: flex; gap: 10px; margin: 1rem 0; align-items: center; }
        .filter-form input[type="text"] { flex-grow: 1; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; }
        .filter-form button, .export-btn { padding: 0.5rem 1rem; background-color: #007bff; color: white; text-decoration: none; border: none; border-radius: 4px; cursor: pointer; }
        .export-btn { background-color: #28a745; }
        .table-container { width: 100%; overflow-x: auto; border: 1px solid #ddd; background: #fff; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.5rem; border: 1px solid #ddd; text-align: left; white-space: nowrap; }
        th { background-color: #f4f4f4; }
        .pagination { margin-top: 1rem; }
        .pagination a { margin: 0 2px; padding: 5px 10px; text-decoration: none; border: 1px solid #ddd; color: #007bff; }
        .pagination strong { margin: 0 2px; padding: 5px 10px; border: 1px solid #007bff; background: #007bff; color: white; }
    </style>
</head>
<body>
<h2>CSV Data Viewer</h2>

<div th:if="${error}" class="error" th:text="${error}"></div>

<div class="info">
    <strong>Available columns:</strong>
    <span th:each="col : ${columnNames}">
            <code th:text="${col}"></code>
        </span>
</div>

<form th:action="@{/view}" method="get" class="filter-form">
    <input type="text" name="filter" placeholder="Enter filter rule... e.g. price > 100 AND status == 'active'" th:value="${currentFilter}">
    <button type="submit">Filter</button>
    <a th:href="@{/export(filter=${currentFilter})}" class="export-btn">Export Filtered CSV</a>
</form>

<div class="table-container">
    <table>
        <thead>
        <tr>
            <th th:each="header : ${headers}" th:text="${header}"></th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${page.empty}">
            <td th:colspan="${#lists.size(headers)}">No data found.</td>
        </tr>
        <tr th:each="row : ${page.content}">
            <td th:each="header : ${headers}" th:text="${row.get(header)}"></td>
        </tr>
        </tbody>
    </table>
</div>

<div th:if="${page.totalPages > 1}" class="pagination">
        <span th:if="${page.hasPrevious()}">
            <a th:href="@{/view(filter=${currentFilter}, page=${page.number - 1}, size=${page.size})}">Previous</a>
        </span>

    <strong>Page <span th:text="${page.number + 1}"></span> of <span th:text="${page.totalPages}"></span></strong>

    <span th:if="${page.hasNext()}">
            <a th:href="@{/view(filter=${currentFilter}, page=${page.number + 1}, size=${page.size})}">Next</a>
        </span>

    <div>Total Rows (Filtered): <span th:text="${page.totalElements}"></span></div>
</div>

<a th:href="@{/}" style="display:inline-block; margin-top: 1rem;">Upload new file</a>

</body>
</html>